@model QuanLyThueXe.Models.Car
@using QuanLyThueXe.Helpers

@{
    ViewData["Title"] = "Chi tiết xe";
    var canEdit = ViewBag.CanEdit as bool? ?? false;
    var isLoggedIn = ViewBag.IsLoggedIn as bool? ?? false;
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-12 mb-3">
            <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">
                ⬅️ Quay lại danh sách xe
            </a>
            @if (canEdit)
            {
                <a asp-controller="Car" asp-action="Edit" asp-route-id="@Model.CarId" class="btn btn-warning">
                    ✏️ Sửa thông tin xe
                </a>
            }
        </div>
    </div>

    <div class="row">
        <div class="col-md-5">
            <div class="card shadow">
                <img src="@ImageHelper.GetCarImageUrl(Model)" 
                     alt="@Model.Brand @Model.Model" 
                     class="card-img-top" 
                     style="height: 400px; object-fit: cover;" />
            </div>
        </div>
        <div class="col-md-7">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="card-title mb-0">@Model.Brand @Model.Model</h3>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <th width="30%">Mã xe:</th>
                            <td>@Model.CarId</td>
                        </tr>
                        <tr>
                            <th>Biển số:</th>
                            <td><strong>@Model.LicensePlate</strong></td>
                        </tr>
                        <tr>
                            <th>Hãng:</th>
                            <td>@Model.Brand</td>
                        </tr>
                        <tr>
                            <th>Model:</th>
                            <td>@Model.Model</td>
                        </tr>
                        <tr>
                            <th>Loại xe:</th>
                            <td>
                                <span class="badge bg-info">@Model.VehicleType</span>
                            </td>
                        </tr>
                        <tr>
                            <th>Giá thuê/ngày:</th>
                            <td>
                                <h4 class="text-danger mb-0">@PriceHelper.FormatPrice(Model.PricePerDay)</h4>
                            </td>
                        </tr>
                        <tr>
                            <th>Trạng thái:</th>
                            <td>
                                @if (Model.Status == "Available")
                                {
                                    <span class="badge bg-success">Có sẵn</span>
                                }
                                else
                                {
                                    <span class="badge bg-danger">Đã thuê</span>
                                }
                            </td>
                        </tr>
                    </table>

                    <hr />

                    @if (Model.Status == "Available")
                    {
                        if (isLoggedIn)
                        {
                            <a asp-controller="Reservation" asp-action="Create" asp-route-carId="@Model.CarId"
                               class="btn btn-primary btn-lg w-100">
                                🚗 Đặt thuê xe ngay
                            </a>
                        }
                        else
                        {
                            <div class="alert alert-info">
                                <strong>💡 Lưu ý:</strong> Bạn cần đăng nhập để đặt thuê xe.
                            </div>
                            <a asp-controller="Account" asp-action="Login" 
                               class="btn btn-primary btn-lg w-100">
                                Thuê Xe
                            </a>
                        }
                    }
                    else
                    {
                        <div class="alert alert-warning">
                            <strong>⚠️ Xe này hiện không có sẵn</strong> - Đang được thuê bởi khách hàng khác.
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
